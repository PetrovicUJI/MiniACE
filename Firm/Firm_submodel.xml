<!DOCTYPE xmodel SYSTEM "http://miniace.cs.bilgi.edu.tr/XMML.dtd">
<xmodel version="2" >
	<name>Final_Goods</name>
	<version>Version 2.1, 23/09/2017</version>
	<description>Authors: Marko Petrovic</description>
	<models/>
	<environment>
		<constants>
			<variable>
				<type>int</type>
				<name>physical_capital_duration</name>
				<description></description>
			</variable>
			<variable>
				<type>double</type>
				<name>target_profit_rate</name>
				<description></description>
			</variable>
			<variable>
				<type>double</type>
				<name>profit_rate_weights</name>
				<description></description>
			</variable>
			<variable>
				<type>double</type>
				<name>target_capacity_utilization</name>
				<description></description>
			</variable>
			<variable>
				<type>double</type>
				<name>capacity_utilization_weights</name>
				<description></description>
			</variable>
			<variable>
				<type>int</type>
				<name>bankruptcy_period</name>
				<description></description>
			</variable>
		</constants>
		<functionFiles>
		   <file>Firm_Producer_Functions.c</file>
		</functionFiles>
		<timeUnits/>
		<dataTypes>
			<dataType>
				<name>Physical_capital_batch</name>
				<description>A batch of physical capital.</description>
				<!-- id, months_in_use, capital_units, price, current_value, productivity  -->
				<variables>
					<variable>
						<type>int</type>
						<name>id</name>
						<description></description>
					</variable>
					<variable>
						<type>int</type>
						<name>months_in_use</name>
						<description></description>
					</variable>
					<variable>
						<type>double</type>
						<name>capital_units</name>
						<description></description>
					</variable>
					<variable>
						<type>double</type>
						<name>price</name>
						<description></description>
					</variable>
					<variable>
						<type>double</type>
						<name>current_value</name>
						<description></description>
					</variable>
					<variable>
						<type>double</type>
						<name>productivity</name>
						<description></description>
					</variable>
				</variables>
			</dataType>
		</dataTypes>
	</environment>
	<agents>
		<xagent>
			<name>Firm</name>
			<description></description>
			<memory>
				<variable>
					<type>int</type>
					<name>remaining_days_of_bankruptcy</name>
					<description></description>
				</variable>
				<variable>
					<type>double</type>
					<name>expected_demand</name>
					<description>Expected demand in the current month.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>production_plan</name>
					<description>A planned production quantity for the current month.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>investment_plan</name>
					<description>A planned investment quantity for the current month.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>productivity</name>
					<description>The productivity parameter in the production function.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>capacity_utilization</name>
					<description></description>
				</variable>
				<variable>
					<type>double</type>
					<name>capital_labor_ratio</name>
					<description></description>
				</variable>
				<variable>
					<type>double</type>
					<name>physical_capital</name>
					<description>Real capital stock.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>inventories</name>
					<description>Real final goods stock.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>monthly_sold_quantity</name>
					<description>A sold quantity in the current month.</description>
				</variable>
				<variable>
					<type>double_array</type>
					<name>sold_quantities_vector</name>
					<description>A vector of monthly sold quantities in the last "n" months.</description>
				</variable>
				<variable>
					<type>Physical_capital_batch_array</type>
					<name>physical_capital_stock</name>
					<description>A vector of all the batch of capital goods.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>physical_capital_price</name>
					<description>The price of physical capital.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>price</name>
					<description>The price of final goods.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>price_last_month</name>
					<description>The price of final goods in month t-1.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>production</name>
					<description>Produced quantity of final goods.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>physical_capital_depreciation_cost</name>
					<description>The value of physical capital depreciation.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>unit_costs</name>
					<description>Unit_production_costs.</description>
				</variable>	
				<variable>
					<type>double</type>
					<name>mark_up</name>
					<description>Markup rate.</description>
				</variable>	
				<variable>
					<type>double</type>
					<name>cb_trust</name>
					<description>The trust in the central bank.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>inflation_target</name>
					<description>The inflation target of the central bank.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>average_demand_level</name>
					<description>The average demand per company in the economy.</description>
				</variable>
				<variable>
					<type>double</type>
					<name>average_wage_level</name>
					<description>The average wage in the economy.</description>
				</variable>
			</memory>
			<functions>
				<function>
					<name>Firm_count_days_in_bankruptcy</name>
					<description></description>
					<currentState>Firm_Status</currentState>
					<nextState>Firm_BankruptcyCapacityUpdate</nextState>
					<condition>
						<not>
							<lhs>
								<value>a.active</value>
							</lhs>
							<op>EQ</op>
							<rhs>
								<value>1</value>
							</rhs>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_BankruptcyCapacityUpdate</currentState>
					<nextState>Firm_BankruptcyState</nextState>
					<condition>
						<not>
							<time>
								<period>monthly</period>
								<phase>a.last_day_of_month_to_act</phase>
							</time>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_update_capacity</name>
					<description></description>
					<currentState>Firm_BankruptcyCapacityUpdate</currentState>
					<nextState>Firm_BankruptcyState</nextState>
					<condition>
						<time>
							<period>monthly</period>
							<phase>a.last_day_of_month_to_act</phase>
						</time>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_BankruptcyState</currentState>
					<nextState>Firm_BankruptcyPriceSetting</nextState>
					<condition>
						<not>
							<lhs>
								<value>a.remaining_days_of_bankruptcy</value>
							</lhs>
							<op>EQ</op>
							<rhs>
								<value>0</value>
							</rhs>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_calculate_physical_capital_needs</name>
					<description></description>
					<currentState>Firm_BankruptcyState</currentState>
					<nextState>Firm_Reset</nextState>
					<condition>
							<lhs>
								<value>a.remaining_days_of_bankruptcy</value>
							</lhs>
							<op>EQ</op>
							<rhs>
								<value>0</value>
							</rhs>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_reset_to_enter_the_market</name>
					<description></description>
					<currentState>Firm_Reset</currentState>
					<nextState>Firm_BankruptcyFinancialPlanning</nextState>
					<inputs/>
					<outputs>
						<output>
							<messageName>final_goods_shipping</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Firm_calculate_financial_needs</name>
					<description></description>
					<currentState>Firm_BankruptcyFinancialPlanning</currentState>
					<nextState>Firm_Bailout</nextState>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_send_bailout_notification</name>
					<description></description>
					<currentState>Firm_Bailout</currentState>
					<nextState>Firm_BankruptcyPhysicalCapitalMarket</nextState>
					<inputs/>
					<outputs>
						<output>
							<messageName>bailout</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_BankruptcyPhysicalCapitalMarket</currentState>
					<nextState>Firm_BankruptcyFinancialPayments</nextState>
					<condition>
						<not>
							<lhs>
								<value>a.investment_plan</value>
							</lhs>
							<op>GT</op>
							<rhs>
								<value>0</value>
							</rhs>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_send_physical_capital_order</name>
					<description></description>
					<currentState>Firm_BankruptcyPhysicalCapitalMarket</currentState>
					<nextState>Firm_BankruptcyPhysicalCapitalDelivery</nextState>
					<condition>
						<lhs>
							<value>a.investment_plan</value>
						</lhs>
						<op>GT</op>
						<rhs>
							<value>0</value>
						</rhs>
					</condition>
					<inputs/>
					<outputs>
						<output>
							<messageName>physical_capital_order</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Firm_receive_physical_capital</name>
					<description></description>
					<currentState>Firm_BankruptcyPhysicalCapitalDelivery</currentState>
					<nextState>Firm_BankruptcyFinancialPayments</nextState>
					<inputs>
						<input>
							<messageName>physical_capital_delivery</messageName>
							<filter>
								<lhs>
									<value>a.id</value>
								</lhs>
								<op>EQ</op>
								<rhs>
									<value>m.buyer_id</value>
								</rhs>
							</filter>
						</input>
					</inputs>
					<outputs/>
				</function>
				<function>
					<name>Firm_repay_debt</name>
					<description></description>
					<currentState>Firm_BankruptcyFinancialPayments</currentState>
					<nextState>Firm_BankAccountUpdate</nextState>
					<inputs/>
					<outputs>
						<output>
							<messageName>loan_repayment</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_BankruptcyPriceSetting</currentState>
					<nextState>Firm_BankruptcyDailyAccounting</nextState>
					<condition>
						<not>
							<time>
								<period>monthly</period>
								<phase>a.day_of_month_to_act</phase>
							</time>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_update_price</name>
					<description></description>
					<currentState>Firm_BankruptcyPriceSetting</currentState>
					<nextState>Firm_BankruptcyLaborMarket</nextState>
					<condition>
						<time>
							<period>monthly</period>
							<phase>a.day_of_month_to_act</phase>
						</time>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_fire_workers</name>
					<description></description>
					<currentState>Firm_BankruptcyLaborMarket</currentState>
					<nextState>Firm_FireSell</nextState>
					<inputs/>
					<outputs>
						<output>
							<messageName>redundancies</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_FireSell</currentState>
					<nextState>Firm_BankruptcyDailyAccounting</nextState>
					<condition>
						<not>
							<lhs>
								<value>a.inventories</value>
							</lhs>
							<op>GT</op>
							<rhs>
								<value>0</value>
							</rhs>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_send_final_goods_to_the_market</name>
					<description></description>
					<currentState>Firm_FireSell</currentState>
					<nextState>Firm_BankruptcyDailyAccounting</nextState>
					<condition>
						<lhs>
							<value>a.inventories</value>
						</lhs>
						<op>GT</op>
						<rhs>
							<value>0</value>
						</rhs>
					</condition>
					<inputs/>
					<outputs>
						<output>
							<messageName>final_goods_shipping</messageName>
						</output>
					</outputs>
				</function>
				<function>
					<name>Firm_receive_updates_from_the_final_goods_market</name>
					<description></description>
					<currentState>Firm_BankruptcyDailyAccounting</currentState>
					<nextState>Firm_BankAccountUpdate</nextState>
					<inputs>
						<input>
							<messageName>final_goods_market_transaction_update</messageName>
							<filter>
								<lhs>
									<value>a.id</value>
								</lhs>
								<op>EQ</op>
								<rhs>
									<value>m.seller_id</value>
								</rhs>
							</filter>
						</input>
					</inputs>
					<outputs/>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_Status</currentState>
					<nextState>Firm_ProductionActivity</nextState>
					<condition>
						<lhs>
							<value>a.active</value>
						</lhs>
						<op>EQ</op>
						<rhs>
							<value>1</value>
						</rhs>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_plan_production_quantity</name>
					<description></description>
					<currentState>Firm_ProductionActivity</currentState>
					<nextState>Firm_LaborDemandPlanning</nextState>
					<condition>
						<time>
							<period>monthly</period>
							<phase>a.day_of_month_to_act</phase>
						</time>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_plan_labor_demand</name>
					<description></description>
					<currentState>Firm_LaborDemandPlanning</currentState>
					<nextState>Firm_InvestmentPlanning</nextState>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_plan_investment</name>
					<description></description>
					<currentState>Firm_InvestmentPlanning</currentState>
					<nextState>Firm_FinancialPlanning</nextState>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_ProductionActivity</currentState>
					<nextState>Firm_DailyAccounting</nextState>
					<condition>
						<not>
							<time>
								<period>monthly</period>
								<phase>a.day_of_month_to_act</phase>
							</time>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_adjust_investment_plan</name>
					<description></description>
					<currentState>Firm_InvestmentPlanAdjustment</currentState>
					<nextState>Firm_LaborDemand</nextState>
					<condition>
						<lhs>
							<value>a.external_financial_needs</value>
						</lhs>
						<op>GT</op>
						<rhs>
							<value>1</value>
						</rhs>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Idle</name>
					<description></description>
					<currentState>Firm_InvestmentPlanAdjustment</currentState>
					<nextState>Firm_LaborDemand</nextState>
					<condition>
						<not>
							<lhs>
								<value>a.external_financial_needs</value>
							</lhs>
							<op>GT</op>
							<rhs>
								<value>1</value>
							</rhs>
						</not>
					</condition>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_produce_final_goods</name>
					<description></description>
					<currentState>Firm_Production</currentState>
					<nextState>Firm_PriceSetting</nextState>
					<inputs/>
					<outputs/>
				</function>
				<function>
					<name>Firm_calculate_unit_costs_and_set_price</name>
					<description></description>
					<currentState>Firm_PriceSetting</currentState>
					<nextState>Firm_FinalGoodsShipping</nextState>
					<inputs/>
					<outputs/>
				</function>
			</functions>
		</xagent>
	</agents>
	<messages>
		<message>
			<name>bailout</name>
			<description>Message added by an agent to the government.</description>
			<variables>
			<!-- (gov_id, agent_id, bailout_amount) -->
				<variable>
					<type>int</type>
					<name>gov_id</name>
					<description></description>
				</variable>
				<variable>
					<type>int</type>
					<name>agent_id</name>
					<description></description>
				</variable>
				<variable>
					<type>double</type>
					<name>bailout_amount</name>
					<description>The amount of money needed.</description>
				</variable>
			</variables>
		</message>
	</messages>
</xmodel>
